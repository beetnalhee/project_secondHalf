<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper	namespace="com.ezen.springmvc.domain.chat.mapper.ChatMapper">
	<!-- 채팅방 생성 -->
	<insert id="createChat" parameterType="com.ezen.springmvc.domain.chat.dto.ChatDto" >
		INSERT INTO chat_room(room_id, created_at, sender_id, receiver_id)
		VALUES(#{roomId}, SYSDATE, #{senderId}, #{receiverId})
	</insert>

	<!-- 채팅방 목록 조회 -->
		<select id="findMyChatList" resultType="com.ezen.springmvc.domain.chat.dto.ChatDto">
			SELECT room_id, created_at, sender_id, receiver_id
			FROM chat_room
			ORDER BY created_at DESC
		</select>


	<!-- 룸아이디로 채팅방 조회 -->
	<select id="findChatRoom" resultType="com.ezen.springmvc.domain.chat.dto.ChatDto">
		SELECT room_id, created_at, sender_id, receiver_id
		FROM chat_room
		WHERE room_id = #{roomId}
	</select>

	<!-- 회원 닉네임으로 채팅방 검색  -->
	<select id="findChatRoomsByNickname" resultType="com.ezen.springmvc.domain.chat.dto.ChatDto">
		SELECT cr.room_id, cr.sender, cr.receiver, cr.created_at
		FROM chat_room cr
				 JOIN member m_sender ON cr.sender = m_sender.member_id
				 JOIN member m_receiver ON cr.receiver = m_receiver.member_id
		WHERE m_sender.nickname = #{nickname} OR m_receiver.nickname = #{nickname}
	</select>

	<!-- 같은 receiverId 있는지 조회 -->
	<select id="findSameReceiver" resultType="com.ezen.springmvc.domain.chat.dto.ChatDto">
		SELECT room_id, created_at, sender_id, receiver_id
		FROM chat_room
		WHERE receiver_id = #{receiverId}
	</select>


</mapper>

